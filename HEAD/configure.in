# Original Author was Kalle@kde.org
# I lifted it in some mater. (Stephan Kulow)
# I used much code from Janos Farkas

dnl Process this file with autoconf to produce a configure script.

AC_INIT(acinclude.m4) dnl a source file from your sub dir

dnl This is so we can use kde-common
AC_CONFIG_AUX_DIR(admin)

AC_CANONICAL_SYSTEM 

dnl Automake doc recommends to do this only here. (Janos)
AM_INIT_AUTOMAKE(yammi,0.8.0)

KDE_SET_PREFIX
KDE_USE_QT(3)

AC_PREFIX_DEFAULT(/usr/local)
if test "x$prefix" = "xNONE"; then
  prefix=$ac_default_prefix
  ac_configure_args="$ac_configure_args --prefix $prefix"
fi

dnl generate the config header
AM_CONFIG_HEADER(config.h) dnl at the distribution this done

dnl Checks for programs.
AC_CHECK_COMPILERS

dnl CXXFLAGS="$NOOPT_CXXFLAGS" dnl __kdevelop[noopt]__
dnl CFLAGS="$NOOPT_CFLAGS" dnl __kdevelop[noopt]__
dnl CXXFLAGS="$CXXFLAGS $USE_EXCEPTIONS" dnl __kdevelop[exc]__


dnl -------------------------------
dnl Configure switches.
dnl -------------------------------
AC_ARG_ENABLE(xmms,
[  --disable-xmms             disable support for xmms (don't need xmmsctrl)], enable_xmms=no, enable_xmms=yes)
AC_ARG_ENABLE(noatun,
[  --disable-noatun           disable support for noatun (don't use kdelibs)], enable_noatun=no, enable_noatun=yes)
AC_ARG_ENABLE(ogglibs,
[  --disable-ogglibs          disable support of ogg libs for reading ogg tags], enable_ogglibs=no, enable_ogglibs=yes)
AC_ARG_ENABLE(id3lib,
[  --disable-id3lib           disable support of id3lib for reading id3 tags], enable_id3lib=no, enable_id3lib=yes)


dnl -------------------------------
dnl Checks for libraries.
dnl -------------------------------

# standard C++ library
AC_CHECK_LIB( stdc++, cout, , AC_MSG_ERROR( *** stdc++ library is required *** ), )

dnl XMMS support
if test "x$enable_xmms" = "xyes"; then
    AC_CHECK_LIB( xmms, xmms_remote_get_version, , enable_xmms=no, )
fi
if test "x$enable_xmms" != "xyes"; then
    AC_MSG_WARN( *** xmms support disabled *** )
else
    AC_DEFINE(ENABLE_XMMS)
    AC_MSG_NOTICE( *** xmms support enabled *** )
fi

dnl Noatun/KDE support (for proper kde app: add "-lkdeui -lkio ")
if test "x$enable_noatun" = "xyes"; then
dnl does not work yet:    AC_CHECK_LIB( noatun, NoatunApp::preferences, , enable_noatun=no )
    LIBS="-lkdecore $LIBS"
fi
if test "x$enable_noatun" != "xyes"; then
    AC_MSG_WARN( *** noatun support disabled *** )
else
    AC_DEFINE(ENABLE_NOATUN)
    AC_MSG_NOTICE( *** noatun support enabled *** )
fi

if [test "x$enable_xmms" != "xyes"] && [test "x$enable_noatun" != "xyes"] ; then
    AC_MSG_NOTICE( *** Warning: No media player available! (either xmms or noatun support is strongly recommended) *** )
fi

dnl OGG vorbis libraries
if test "x$enable_ogglibs" = "xyes"; then
   dnl Libraries required for reading ogg tags, if not found 'enable_ogglibs' is disabled
    AC_CHECK_LIB(ogg, ogg_sync_init, , enable_ogglibs=no, )
    AC_CHECK_LIB(vorbis, vorbis_comment_init, , enable_ogglibs=no, )
    AC_CHECK_LIB(vorbisfile, ov_open, , enable_ogglibs=no, )
    AC_DEFINE(ENABLE_OGGLIBS)
fi

if test "x$enable_ogglibs" != "xyes"; then
    AC_MSG_WARN( *** Warning: ogg libs support disabled => no reading/writing of tags in ogg files! *** )
else
    AC_MSG_NOTICE( reading/writing of tags in ogg files is supported )
fi

dnl id3lib library
if test "x$enable_id3lib" = "xyes"; then
    AC_CHECK_LIB( id3, ID3Tag_Link, , enable_id3lib=no,
		-lz )
    # if still adding libid3 then...
    if test "x$enable_id3lib" = "xyes"; then
        AC_CHECK_LIB( z, deflate, , enable_id3lib=no, )
    fi
fi
if test "x$enable_id3lib" != "xyes"; then
    AC_MSG_WARN( *** Warning: id3lib support disabled => no reading/writing of tags in mp3 files! *** )
else
    AC_MSG_NOTICE( reading/writing of tags in MP3 files is supported )
    AC_DEFINE(ENABLE_ID3LIB)
fi


dnl ---------------------
dnl end of library checks
dnl ---------------------


AC_ENABLE_SHARED(yes)
AC_ENABLE_STATIC(no)
KDE_PROG_LIBTOOL

all_libraries="$all_libraries $USER_LDFLAGS"
all_includes="$all_includes $USER_INCLUDES"
AC_SUBST(all_includes)
AC_SUBST(all_libraries)

dnl for NLS support. Call them in this order!
dnl WITH_NLS is for the po files
AM_KDE_WITH_NLS

AC_PATH_KDE

KDE_CREATE_SUBDIRSLIST

dnl add here all your Makefiles. This are created by configure
AC_OUTPUT(Makefile yammi/Makefile yammi/docs/Makefile yammi/docs/en/Makefile yammi/icons/Makefile yammi/mp3info/Makefile )


echo "
Configuration for $PACKAGE $VERSION :
--------------------------------
 Source code location .: $srcdir
 Host System Type .....: $host
 Preprocessor .........: $CC $CPPFLAGS
 Compiler .............: $CC $CFLAGS $LIBFLAC_CFLAGS
 Linker ...............: $CC $LDFLAGS $LIBS $LIBFLAC_LIBS
 XMMS support .........: $enable_xmms
 Noatun support .......: $enable_noatun
 ogglibs support ......: $enable_ogglibs
 id3lib support .......: $enable_id3lib
 Install path .........: $prefix
   If this path does not exist or is not the desired install path,
   you should re-run configure, giving a suitable path with the --prefix option
   For example ./configure --prefix=/opt/kde3

 Look for any WARNINGS output by the configure script
 If you're satisfied, type 'make' to build $PACKAGE $VERSION,
 and then 'make install' for installation.
"

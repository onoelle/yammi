<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>fuzzsrch.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.6 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>fuzzsrch.h</h1><div class="fragment"><pre>00001 
00041 
00042 <font class="preprocessor">#ifndef FUZZSRCH_H</font>
00043 <font class="preprocessor"></font><font class="preprocessor">#define FUZZSRCH_H</font>
00044 <font class="preprocessor"></font>
00045 <font class="preprocessor">#define  MaximumEntryLength 200     // maximum length of one searchable entry</font>
00046 <font class="preprocessor"></font><font class="preprocessor">#define  NoBestMatches 200          // how many hits to keep in best matches list</font>
00047 <font class="preprocessor"></font><font class="preprocessor">#define  MaximumNgramLen 10         // maximum length of used ngrams (more than 5 doesn't help a lot...)</font>
00048 <font class="preprocessor"></font>
00049 
00050 <font class="comment">// fuzzysearch returns an array of &lt;NoBestMatches&gt; entries of this class</font>
00051 <font class="comment">// beware of null-pointers if checkNext is invoked less then &lt;NoBestMatches&gt; times!</font>
00052 <font class="comment">// in this case (eg only five streets in db), evaluate the returned array until the first null-pointer!</font>
00053 <font class="comment">// objPtr can be filled with anything when invoking FuzzySearch.checkNext(...)</font>
00054 <font class="keyword">class </font>BestMatchEntry {
00055 <font class="keyword">public</font>:
00056     <font class="keywordtype">int</font> sim;                        <font class="comment">// similarity coefficient, between 0(no match at all) and 1000 (all ngrams found)</font>
00057     <font class="keywordtype">char</font>* objName;                  <font class="comment">// original name of the object</font>
00058     <font class="keywordtype">char</font>* preparedName;             <font class="comment">// preprocessed name</font>
00059     <font class="keywordtype">void</font>* objPtr;                   <font class="comment">// user-filled...whatever you like</font>
00060     BestMatchEntry(<font class="keyword">const</font> <font class="keywordtype">int</font> sim_, <font class="keyword">const</font> <font class="keywordtype">char</font>* objName_, <font class="keyword">const</font> <font class="keywordtype">char</font>* preparedName_, <font class="keywordtype">void</font>* objPtr_);
00061     ~BestMatchEntry();
00062 };
00063 
00064 
00065 
00066 <font class="comment">// NgramRep and NgramEntry are needed to represent the searchstring</font>
00067 <font class="comment">// =&gt; only created once per search, so we don't worry too much about efficiency/space here</font>
00068 
00069 <font class="comment">// represents a single ngram</font>
00070 <font class="keyword">class </font>NgramEntry {
00071 <font class="keyword">public</font>:
00072     <font class="keywordtype">int</font> length;
00073     <font class="keywordtype">int</font> frequency;                          <font class="comment">// count how many times ngram appears</font>
00074     <font class="keywordtype">int</font> entropy;                            <font class="comment">// should give an information value to the appearance of this ngram</font>
00075     <font class="keywordtype">int</font> precondition[2];                    <font class="comment">// index of those ngrams that must be found for this ngram to be "appearable"</font>
00076     <font class="keywordtype">bool</font> found;                             <font class="comment">// flag for checking precondition</font>
00077     <font class="keywordtype">char</font> str[MaximumNgramLen];              <font class="comment">// the ngram itself</font>
00078     NgramEntry(<font class="keywordtype">int</font> length_, <font class="keyword">const</font> <font class="keywordtype">char</font>* strStart, <font class="keywordtype">int</font> pre1, <font class="keywordtype">int</font> pre2);
00079 };
00080 
00081 
00082 
00083 <font class="comment">// a searchstring is represented as a number of ngrams, organised by this class</font>
00084 <font class="keyword">class </font>NgramRep {
00085 <font class="keyword">public</font>:
00086     <font class="keywordtype">int</font> minNgramLen, maxNgramLen, noLevels;
00087     <font class="keywordtype">int</font> noNgrams;                           <font class="comment">// no ngrams representing the searchstring</font>
00088     <font class="keywordtype">int</font> noNgramsInLevel[MaximumNgramLen];
00089     <font class="keywordtype">int</font> lenNgramsInLevel[MaximumNgramLen];
00090     <font class="keywordtype">int</font> maxScore;                           <font class="comment">// score of all ngrams added up = maximum score an entry can get</font>
00091     NgramEntry** ngs;                       <font class="comment">// pointer to an array of ngrams</font>
00092     NgramRep(<font class="keywordtype">char</font>* searchStr, <font class="keywordtype">int</font> length, <font class="keywordtype">int</font> minNgramLen_, <font class="keywordtype">int</font> maxNgramLen_);
00093     ~NgramRep();
00094 };
00095 
00096 
00097 
00098 
00099 <font class="comment">// main class for performing a fuzzy search</font>
00100 <font class="comment">//</font>
00101 <font class="comment">// normal use in 4 steps:</font>
00102 <font class="comment">// step 1: create class + initialize with searchstring and params</font>
00103 <font class="comment">// step 2: checkNext(...) for all entries in database</font>
00104 <font class="comment">// step 3: (optional) newOrder(): reorder according to frequencies</font>
00105 <font class="comment">// step 4: getBestMatchesList() and do sth. with the result</font>
00106 <font class="comment">//</font>
00107 <font class="comment">// good values: minNgramLen=2 and maxNgramLen=5</font>
00108 <font class="comment">//</font>
00109 <font class="comment">// class is robust against:</font>
00110 <font class="comment">// - no matches at all (first found entries with sim=0 are returned)</font>
00111 <font class="comment">// - searchstrings longer than MaximumEntryLength (=&gt; cut off)</font>
00112 <font class="comment">// - entries longer than MaximumEntryLength (=&gt; cut off)</font>
00113 <font class="comment">// - searchstrings with length 0 (no meaningful result, but no crash)</font>
00114 <font class="comment">// - entries with length 0 (probably won't appear in result, which should be okay)</font>
00115 <font class="comment">//</font>
00116 <font class="comment">// beware of null-pointers in step 4 if best matches list is not completely filled</font>
00117 <font class="comment">// (not enough objects checked to fill list)</font>
00118 <font class="keyword">class </font>FuzzySearch {
00119 <font class="keyword">public</font>:
00120     <font class="comment">// creates a not initialized class</font>
00121     FuzzySearch();
00122 
00123     <font class="comment">// creates and initializes class</font>
00124     FuzzySearch(<font class="keyword">const</font> <font class="keywordtype">char</font>* searchstStr, <font class="keywordtype">int</font> minNgramLen, <font class="keywordtype">int</font> maxNgramLen);
00125 
00126     <font class="comment">// frees all resources, including the best matches list</font>
00127     ~FuzzySearch();
00128 
00129     <font class="comment">// initializes an existing class</font>
00130     <font class="keywordtype">void</font> initialize(<font class="keyword">const</font> <font class="keywordtype">char</font>* searchstStr, <font class="keywordtype">int</font> minNgramLen, <font class="keywordtype">int</font> maxNgramLen);
00131 
00132     <font class="comment">// checks next entry from database, returns similarity value for that entry</font>
00133     <font class="keywordtype">int</font> checkNext(<font class="keyword">const</font> <font class="keywordtype">char</font>* nextObj, <font class="keywordtype">void</font>* objPtr);
00134 
00135     <font class="comment">// returns the result array of best matches, 0 if class was not initialized</font>
00136     BestMatchEntry** getBestMatchesList();
00137 
00138     <font class="comment">// performs the newOrder mechanism to take frequency of ngrams into account</font>
00139     <font class="keywordtype">void</font> newOrder();
00140 
00141     NgramEntry**    ngs;            <font class="comment">// should be protected, but for testing we want to have access</font>
00142     NgramRep*       ngr;            <font class="comment">// same (we want to have a look at ngrams and their frequency/entropy)</font>
00143     
00144 <font class="keyword">protected</font>:
00145     BestMatchEntry* bme[NoBestMatches];
00146     <font class="keywordtype">int</font>     noObjects;
00147     <font class="keywordtype">int</font>     minSim;
00148     <font class="keywordtype">int</font>     searchStrLen;
00149     <font class="keywordtype">char</font>    searchStr[MaximumEntryLength];
00150     <font class="keywordtype">char</font>    preparedSearchStr[MaximumEntryLength];
00151     
00152     <font class="keywordtype">int</font> prepareString(<font class="keywordtype">char</font>* convStr, <font class="keyword">const</font> <font class="keywordtype">char</font>* originStr);
00153     <font class="comment">// compares two best match entries, considering their similarity value</font>
00154     <font class="keyword">static</font> <font class="keywordtype">int</font> FuzzySearch::bmeCompare(<font class="keyword">const</font> <font class="keywordtype">void</font> *elem1, <font class="keyword">const</font> <font class="keywordtype">void</font> *elem2)<font class="keyword"></font>
00155 <font class="keyword">    </font>{
00156         <font class="keywordtype">int</font> sim1=(*(BestMatchEntry**)elem1)-&gt;sim;
00157         <font class="keywordtype">int</font> sim2=(*(BestMatchEntry**)elem2)-&gt;sim;
00158         <font class="keywordflow">return</font> sim2-sim1;
00159     }
00160     <font class="keywordtype">int</font> insertIntoOrderedList(<font class="keywordtype">int</font> similarity, <font class="keyword">const</font> <font class="keywordtype">char</font>* insertObject, <font class="keyword">const</font> <font class="keywordtype">char</font>* prepObject, <font class="keywordtype">void</font>* objPtr);
00161 };
00162 
00163 <font class="preprocessor">#endif</font>
</font></pre></div><hr><address><small>Generated at Wed Dec 5 23:13:10 2001 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.6 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
